"use strict";angular.module("barliftApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ui.router","oc.lazyLoad"]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"Admin",editor:"User",bar:"Bar"}).config(["$stateProvider","$urlRouterProvider","$ocLazyLoadProvider","$httpProvider","USER_ROLES",function(a,b,c,d,e){b.otherwise("/"),c.config({debug:!1}),a.state("home",{"abstract":!0,templateUrl:"views/landingpage/home.partial.html",controller:"MainCtrl",data:{authorizedRoles:[e.all]}}).state("home.index",{url:"/",templateUrl:"views/landingpage/home.index.html",controller:"MainCtrl",data:{authorizedRoles:[e.all]}}).state("home.about",{url:"/about",templateUrl:"views/landingpage/home.about.html",controller:"MainCtrl",data:{authorizedRoles:[e.all]}}).state("home.team",{url:"/team",templateUrl:"views/landingpage/home.team.html",controller:"MainCtrl",data:{authorizedRoles:[e.all]}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",data:{authorizedRoles:[e.all]}}).state("dash",{"abstract":!0,url:"/admin",controller:"AdminCtrl",templateUrl:"views/dash/common/content.html",data:{authorizedRoles:[e.all]}}).state("dash.main",{url:"/main",templateUrl:"views/dash/dash.main.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]}}).state("deals",{"abstract":!0,url:"/deals",templateUrl:"views/dash/common/content.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]}}).state("deals.list",{url:"/list",templateUrl:"views/dash/deals.list.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]}}).state("deals.builder",{url:"/builder",templateUrl:"views/dash/deals.builder.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]},resolve:{loadPlugin:["$ocLazyLoad",function(a){return a.load([{name:"datePicker",files:["css/plugins/datapicker/angular-datapicker.css","js/plugins/datapicker/datePicker.js"]}])}]}}),d.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).run(["$rootScope","$http","$location","$window","$state","AUTH_EVENTS","AuthService","Session",function(a,b,c,d,e,f,g,h){if(a.$state=e,b.defaults.headers.common["X-Parse-Application-Id"]="5DZi1FrdZcwBKXIxMplWsqYu3cEEumlmFDB1kKnC",b.defaults.headers.common["X-Parse-REST-API-Key"]="pMT9AefpMkJfbcJ5fTA2uOGxwpitMII7hpCt8x4O",d.sessionStorage.session){var i=JSON.parse(d.sessionStorage.session);h.create(i.userId,i.userName,i.sessionToken,i.userRole)}a.$on("$stateChangeStart",function(b,d){var e=d.data.authorizedRoles;g.isAuthorized(e)||(b.preventDefault(),g.isAuthenticated()?(a.$broadcast(f.notAuthorized),c.path("/login")):(a.$broadcast(f.notAuthenticated),c.path("/login")))})}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,b,c){return{responseError:function(d){return a.$broadcast({401:c.notAuthenticated,403:c.notAuthorized,419:c.sessionTimeout,440:c.sessionTimeout}[d.status],d),b.reject(d)}}}]),$(document).ready(function(){function a(){var a=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",a+"px");var b=$("nav.navbar-default").height(),c=$("#page-wrapper").height();b>c&&$("#page-wrapper").css("min-height",b+"px"),c>b&&$("#page-wrapper").css("min-height",$(window).height()+"px")}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||a()}),setTimeout(function(){a()})}),$(function(){$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})}),angular.module("barliftApp").controller("MainCtrl",["$scope","Emails","$location","$window","$http","$state",function(a,b,c,d,e,f){a.$state=f,a.getDevice=function(){var a=d.navigator.userAgent,b={android:/Android/i,ios:/iPhone/i};for(var c in b)if(b[c].test(a))return c;return"unknown"},a.isActive=function(a){return a===f.get()},a.slides=[{image:"images/phone-slides/1.png"},{image:"images/phone-slides/2.png"},{image:"images/phone-slides/3.png"},{image:"images/phone-slides/4.png"}]}]),angular.module("barliftApp").controller("LoginCtrl",["$rootScope","$timeout","$scope","$state","User","AuthService","AUTH_EVENTS","Session",function(a,b,c,d,e,f,g,h){c.credentials={username:"",password:""},f.isAuthenticated()&&d.go("dash.main"),c.login=function(b){f.login(b).then(function(b){a.$broadcast(g.loginSuccess),d.go("dash.main")},function(){a.$broadcast(g.loginFailed)})}}]);var app=angular.module("barliftApp");app.controller("AdminCtrl",["$scope","User","Deals","AuthService","$http",function(a,b,c,d,e){a.deals=[],a.user={},a.communities=[],a.dummydate=new Date,b.getCurrent(function(b){a.user=b,c.query(function(b){a.deals=b})}),e.get("https://api.parse.com/1/config").success(function(b,c,d,e){a.communities=b.params.communities}),a.logout=d.logout}]),angular.module("barliftApp").factory("User",["$resource","$http","ParseTypes","Session",function(a,b,c,d){var e=a("https://api.parse.com/1/users/:objectId",{objectId:"@objectId"},{getCurrent:{method:"GET",cache:!0,url:"https://api.parse.com/1/users/me",transformResponse:function(a,b){a=angular.fromJson(a);var d=c.resProcess(a,"_User");return d}},get:{method:"GET",cache:!0,transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}},save:{method:"POST",transformRequest:function(a,b){var d=c.reqProcess(a);return d=angular.toJson(d)},transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}},query:{method:"GET",isArray:!0,transformResponse:function(a,b){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return c.resProcess(a,"_User")});return e}},update:{method:"PUT",transformRequest:function(a,b){var d=c.reqProcess(a);return d=angular.toJson(d)},transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}}});return e}]),angular.module("barliftApp").factory("Deals",["$resource","ParseTypes","Session",function(a,b,c){var d=a("https://api.parse.com/1/classes/Deal/:objectId",{objectId:"@objectId"},{save:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},query:{isArray:!0,transformResponse:function(a,c){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return b.resProcess(a,"Deal")});return e}},update:{method:"PUT",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},"delete":{method:"DELETE"}});return d.newDeal=function(a){var b=new Date,d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes()),e={ACL:{"*":{read:!0},"role:Admin":{read:!0,write:!0}},schema:[{key:"deal_start_date",__type:"Date"},{key:"deal_end_date",__type:"Date"},{key:"user",__type:"Pointer",className:"_User"}],deal_start_date:d,deal_end_date:d,end_utc:d.valueOf(),start_utc:d.valueOf()};return e.ACL[c.userId]={read:!0,write:!0},e.user=c.userId,e.approved=!1,e.num_accepted=0,e},d}]),angular.module("barliftApp").controller("BarCtrl",["$scope","User","Deals","AuthService",function(a,b,c,d){a.deals=[],a.user={},b.getCurrent(function(b){a.user=b,c.query({where:{user:a.user.getPointer()}},function(b){a.deals=b})}),a.logout=d.logout}]),angular.module("barliftApp").factory("ParseTypes",function(){return{resProcess:function(a,b){var c=Object.keys(a);a.schema=[];for(var d=0;d<c.length;d++)if(a[c[d]].__type){var e=a[c[d]].__type;switch(e){case"Pointer":a.schema.push({key:c[d],__type:a[c[d]].__type,className:a[c[d]].className}),a[c[d]]=a[c[d]].objectId;break;case"Date":a.schema.push({key:c[d],__type:a[c[d]].__type}),a[c[d]]=new Date(a[c[d]].iso);break;case"GeoPoint":a.schema.push({key:c[d],__type:a[c[d]].__type}),a[c[d]]={latitude:a[c[d]].latitude,longitude:a[c[d]].longitude}}}return a.getPointer=function(){return{objectId:a.objectId,__type:"Pointer",className:b}},a},reqProcess:function(a){var b=angular.copy(a),c=b.schema;if(c){for(var d=0;d<c.length;d++){var e=c[d].__type,f=b[c[d].key];switch(e){case"Pointer":var g={objectId:f,__type:c[d].__type,className:c[d].className};b[c[d].key]=g;break;case"Date":var h={iso:f,__type:c[d].__type};b[c[d].key]=h;break;case"GeoPoint":var i={__type:c[d].__type,latitude:f.latitude,longitude:f.longitude};b[c[d].key]=i}}delete b.schema}return delete b.getPointer,b}}}),angular.module("barliftApp").factory("AuthService",["$http","$location","$window","Session","User",function(a,b,c,d,e){var f={};return f.login=function(b){return a({url:"https://api.parse.com/1/login",method:"GET",params:b}).then(function(a){return d.create(a.data.objectId,a.data.username,a.data.sessionToken,""),a.data.objectId}).then(function(b){return a({url:"https://api.parse.com/1/roles",method:"GET",params:{where:{users:{$in:[{__type:"Pointer",className:"_User",objectId:b}]}}}})}).then(function(a){d.setRole(a.data.results[0].name),c.sessionStorage.session=JSON.stringify(d)})},f.logout=function(){d.destroy(),delete c.sessionStorage.session,b.path("/login")},f.isAuthenticated=function(){return!!d.userId},f.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),-1!==a.indexOf("*")||f.isAuthenticated()&&-1!==a.indexOf(d.userRole)},f}]),angular.module("barliftApp").service("Session",["$http",function(a){return this.create=function(b,c,d,e){this.userId=b,this.userName=c,this.sessionToken=d,this.userRole=e,a.defaults.headers.common["X-Parse-Session-Token"]=d},this.setRole=function(a){this.userRole=a},this.destroy=function(){this.username=null,this.sessionToken=null,this.userRole=null,this.userId=null,delete a.defaults.headers.common["X-Parse-Session-Token"]},this}]),angular.module("barliftApp").factory("Emails",["$resource","ParseTypes",function(a,b){var c=a("https://api.parse.com/1/classes/email/");return c}]),angular.module("barliftApp").directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(a,b,c,d){var e,f=!1,g=function(){e={},a.options&&(f=a.options.watchEnter!==!0?!1:!0,a.options.types?(e.types=[],e.types.push(a.options.types),a.gPlace.setTypes(e.types)):a.gPlace.setTypes([]),a.options.bounds?(e.bounds=a.options.bounds,a.gPlace.setBounds(e.bounds)):a.gPlace.setBounds(null),a.options.country?(e.componentRestrictions={country:a.options.country},a.gPlace.setComponentRestrictions(e.componentRestrictions)):a.gPlace.setComponentRestrictions(null))};void 0==a.gPlace&&(a.gPlace=new google.maps.places.Autocomplete(b[0],{})),google.maps.event.addListener(a.gPlace,"place_changed",function(){var c=a.gPlace.getPlace();void 0!==c&&(void 0!==c.address_components?a.$apply(function(){a.details=c,d.$setViewValue(b.val())}):f&&h(c))});var h=function(c){var e=new google.maps.places.AutocompleteService;c.name.length>0&&e.getPlacePredictions({input:c.name,offset:c.name.length},function(c,e){if(null==c||0==c.length)a.$apply(function(){a.details=null});else{var f=new google.maps.places.PlacesService(b[0]);f.getDetails({reference:c[0].reference},function(c,e){e==google.maps.GeocoderStatus.OK&&a.$apply(function(){d.$setViewValue(c.formatted_address),b.val(c.formatted_address),a.details=c;b.on("focusout",function(a){b.val(c.formatted_address),b.unbind("focusout")})})})}})};d.$render=function(){var a=d.$viewValue;b.val(a)},a.watchOptions=function(){return a.options},a.$watch(a.watchOptions,function(){g()},!0)}}}),angular.module("barliftApp").factory("Push",["$resource","ParseTypes",function(a,b){var c=a("https://api.parse.com/1/push",null,{push:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}}});return c}]),angular.module("barliftApp").directive("pageTitle",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){var f=function(a,c,e,f,g){var h="INSPINIA | Responsive Admin Theme";c.data&&c.data.pageTitle&&(h="INSPINIA | "+c.data.pageTitle),b(function(){d.text(h)})};a.$on("$stateChangeStart",f)}}}]),angular.module("barliftApp").directive("sideNavigation",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c.metisMenu()})}}}]),angular.module("barliftApp").directive("iboxTools",function(){return{scope:!0,templateUrl:"views/common/ibox_tools.html",restrict:"A",controller:["$scope","$element",function(a,b){a.showhide=function(){var a=b.closest("div.ibox"),c=b.find("i:first"),d=a.find("div.ibox-content");d.slideToggle(200),c.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),a.toggleClass("").toggleClass("border-bottom"),$timeout(function(){a.resize(),a.find("[id^=map-]").resize()},50)},a.closebox=function(){var a=b.closest("div.ibox");a.remove()}}]}}),angular.module("barliftApp").directive("minimalizaSidebar",function(){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function(a,b){a.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},100)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},300)):$("#side-menu").removeAttr("style")}}]}}),angular.module("barliftApp").directive("dealList",function(){return{templateUrl:"views/dash/directives/deal-list.html",restrict:"E",scope:{deals:"="},link:function(a,b,c){}}}),angular.module("barliftApp").directive("dealBuilder",function(){return{templateUrl:"views/dash/directives/deal-builder.html",restrict:"E",link:function(a,b,c){}}});
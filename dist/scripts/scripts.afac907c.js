"use strict";angular.module("barliftApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ui.router","oc.lazyLoad"]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"Admin",editor:"User",bar:"Bar"}).config(["$stateProvider","$urlRouterProvider","$ocLazyLoadProvider","$httpProvider","USER_ROLES",function(a,b,c,d,e){b.otherwise("/"),c.config({debug:!1}),a.state("home",{"abstract":!0,templateUrl:"views/landingpage/home.partial.html",controller:"MainCtrl",data:{authorizedRoles:[e.all]}}).state("home.index",{url:"/",templateUrl:"views/landingpage/home.index.html",data:{authorizedRoles:[e.all]}}).state("home.about",{url:"/about",templateUrl:"views/landingpage/home.about.html",data:{authorizedRoles:[e.all]}}).state("home.team",{url:"/team",templateUrl:"views/landingpage/home.team.html",data:{authorizedRoles:[e.all]}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",data:{authorizedRoles:[e.all]}}).state("bar_feedback",{url:"/bar_feedback/:dealId",templateUrl:"views/bar_feedback.html",controller:"BarFeedbackCtrl",data:{authorizedRoles:[e.all]}}).state("dash",{"abstract":!0,url:"/admin",controller:"AdminCtrl",templateUrl:"views/dash/common/content.html",data:{authorizedRoles:[e.all]}}).state("dash.main",{url:"/main",templateUrl:"views/dash/dash.main.html",data:{authorizedRoles:[e.all]}}).state("deals",{"abstract":!0,url:"/deals",templateUrl:"views/dash/common/content.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]}}).state("deals.list",{url:"/list",templateUrl:"views/dash/deals.list.html",data:{authorizedRoles:[e.all]}}).state("deals.builder",{url:"/builder/:selectedDeal",templateUrl:"views/dash/deals.builder.html",data:{authorizedRoles:[e.all]},resolve:{loadPlugin:["$ocLazyLoad",function(a){return a.load([{name:"datePicker",files:["css/plugins/datapicker/angular-datapicker.css","js/plugins/datapicker/datePicker.js"]}])}]}}).state("venues",{"abstract":!0,url:"/venue",templateUrl:"views/dash/common/content.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]}}).state("venues.list",{url:"/list",templateUrl:"views/dash/venues.list.html",data:{authorizedRoles:[e.all]}}).state("venues.builder",{url:"/builder/:selectedDeal",templateUrl:"views/dash/venues.builder.html",data:{authorizedRoles:[e.all]}}).state("analytics",{"abstract":!0,url:"/analytics",templateUrl:"views/dash/common/content.html",controller:"AdminCtrl",data:{authorizedRoles:[e.all]},resolve:{loadPlugin:["$ocLazyLoad",function(a){return a.load([{files:["js/plugins/chartJs/Chart.min.js"]},{name:"angles",files:["js/plugins/chartJs/angles.js"]}])}]}}).state("analytics.deal",{url:"/deal/:selectedDeal",templateUrl:"views/dash/analytics.deal.html",data:{authorizedRoles:[e.all]}}),d.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]).run(["$rootScope","$http","$location","$window","$state","AUTH_EVENTS","AuthService","Session",function(a,b,c,d,e,f,g,h){if(a.$state=e,b.defaults.headers.common["X-Parse-Application-Id"]="5DZi1FrdZcwBKXIxMplWsqYu3cEEumlmFDB1kKnC",b.defaults.headers.common["X-Parse-REST-API-Key"]="pMT9AefpMkJfbcJ5fTA2uOGxwpitMII7hpCt8x4O",d.sessionStorage.session){var i=JSON.parse(d.sessionStorage.session);h.create(i.userId,i.userName,i.sessionToken,i.userRole)}a.$on("$stateChangeStart",function(b,d){var e=d.data.authorizedRoles;g.isAuthorized(e)||(b.preventDefault(),g.isAuthenticated()?(a.$broadcast(f.notAuthorized),c.path("/login")):(a.$broadcast(f.notAuthenticated),c.path("/login")))})}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,b,c){return{responseError:function(d){return a.$broadcast({401:c.notAuthenticated,403:c.notAuthorized,419:c.sessionTimeout,440:c.sessionTimeout}[d.status],d),b.reject(d)}}}]),$(document).ready(function(){function a(){var a=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",a+"px");var b=$("nav.navbar-default").height(),c=$("#page-wrapper").height();b>c&&$("#page-wrapper").css("min-height",b+"px"),c>b&&$("#page-wrapper").css("min-height",$(window).height()+"px")}$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||a()}),setTimeout(function(){a()})}),$(function(){$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})}),angular.module("barliftApp").controller("MainCtrl",["$scope","Emails","$location","$window","$http","$state",function(a,b,c,d,e,f){a.$state=f,a.getDevice=function(){var a=d.navigator.userAgent,b={android:/Android/i,ios:/iPhone/i};for(var c in b)if(b[c].test(a))return c;return"unknown"},a.isActive=function(a){return a===f.get()},a.slides=[{image:"images/phone-slides/1.png"},{image:"images/phone-slides/2.png"},{image:"images/phone-slides/3.png"},{image:"images/phone-slides/4.png"}]}]),angular.module("barliftApp").controller("LoginCtrl",["$rootScope","$timeout","$scope","$state","User","AuthService","AUTH_EVENTS","Session",function(a,b,c,d,e,f,g,h){c.credentials={username:"",password:""},f.isAuthenticated()&&d.go("dash.main"),c.login=function(b){f.login(b).then(function(b){a.$broadcast(g.loginSuccess),d.go("dash.main")},function(){a.$broadcast(g.loginFailed)})}}]);var app=angular.module("barliftApp");app.controller("AdminCtrl",["$scope","User","Deals","AuthService","Yelp","Venues",function(a,b,c,d,e,f){a.deals=[],a.venues=[],a.user={},a.communities=[],a.today=new Date,b.getCurrent(function(b){a.user=b,c.query({where:{}},function(b){a.deals=b}),f.query({where:{manager:a.user.getPointer()}},function(b){a.venues=b})}),a.logout=d.logout}]),angular.module("barliftApp").factory("User",["$resource","$http","ParseTypes","Session",function(a,b,c,d){var e=a("https://api.parse.com/1/users/:objectId",{objectId:"@objectId"},{getCurrent:{method:"GET",cache:!0,url:"https://api.parse.com/1/users/me",transformResponse:function(a,b){a=angular.fromJson(a);var d=c.resProcess(a,"_User");return d}},get:{method:"GET",cache:!0,transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}},save:{method:"POST",transformRequest:function(a,b){var d=c.reqProcess(a);return d=angular.toJson(d)},transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}},query:{method:"GET",isArray:!0,transformResponse:function(a,b){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return c.resProcess(a,"_User")});return e}},update:{method:"PUT",transformRequest:function(a,b){var d=c.reqProcess(a);return d=angular.toJson(d)},transformResponse:function(a,b){return a=angular.fromJson(a),c.resProcess(a,"_User")}}});return e}]),angular.module("barliftApp").factory("Deals",["$resource","ParseTypes","Session",function(a,b,c){var d=a("https://api.parse.com/1/classes/Deal/:objectId",{objectId:"@objectId"},{save:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},get:{transformResponse:function(a,c){return a=angular.fromJson(a),b.resProcess(a,"Deal")}},query:{isArray:!0,transformResponse:function(a,c){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return b.resProcess(a,"Deal")});return e}},update:{method:"PUT",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},"delete":{method:"DELETE"}});return d.newDeal=function(a){var b=new Date,d=new Date(b.getFullYear(),b.getMonth(),b.getDate()),e={ACL:{"*":{read:!0},"role:Admin":{read:!0,write:!0}},schema:[{key:"deal_start_date",__type:"Date"},{key:"deal_end_date",__type:"Date"},{key:"user",__type:"Pointer",className:"_User"}],deal_start_date:d,deal_end_date:d};return e.ACL[c.userId]={read:!0,write:!0},e.user=c.userId,e.approved=!1,e.num_accepted=0,e},d}]),angular.module("barliftApp").controller("BarCtrl",["$scope","User","Deals","AuthService",function(a,b,c,d){a.deals=[],a.user={},b.getCurrent(function(b){a.user=b,c.query({where:{user:a.user.getPointer()}},function(b){a.deals=b})}),a.logout=d.logout}]),angular.module("barliftApp").factory("ParseTypes",function(){return{resProcess:function(a,b){var c=Object.keys(a);a.schema=[];for(var d=0;d<c.length;d++)if(a[c[d]].__type){var e=a[c[d]].__type;switch(e){case"Pointer":a.schema.push({key:c[d],__type:a[c[d]].__type,className:a[c[d]].className}),a[c[d]]=a[c[d]].objectId;break;case"Date":a.schema.push({key:c[d],__type:a[c[d]].__type}),a[c[d]]=new Date(a[c[d]].iso);break;case"GeoPoint":a.schema.push({key:c[d],__type:a[c[d]].__type}),a[c[d]]={latitude:a[c[d]].latitude,longitude:a[c[d]].longitude}}}return a.getPointer=function(){return{objectId:a.objectId,__type:"Pointer",className:b}},a},reqProcess:function(a){var b=angular.copy(a),c=b.schema;if(c){for(var d=0;d<c.length;d++){var e=c[d].__type,f=b[c[d].key];switch(e){case"Pointer":var g={objectId:f,__type:c[d].__type,className:c[d].className};b[c[d].key]=g;break;case"Date":var h={iso:f,__type:c[d].__type};b[c[d].key]=h;break;case"GeoPoint":var i={__type:c[d].__type,latitude:f.latitude,longitude:f.longitude};b[c[d].key]=i}}delete b.schema}return delete b.getPointer,b}}}),angular.module("barliftApp").factory("AuthService",["$http","$location","$window","Session","User",function(a,b,c,d,e){var f={};return f.login=function(b){return a({url:"https://api.parse.com/1/login",method:"GET",params:b}).then(function(a){return d.create(a.data.objectId,a.data.username,a.data.sessionToken,""),a.data.objectId}).then(function(b){return a({url:"https://api.parse.com/1/roles",method:"GET",params:{where:{users:{$in:[{__type:"Pointer",className:"_User",objectId:b}]}}}})}).then(function(a){d.setRole(a.data.results[0].name),c.sessionStorage.session=JSON.stringify(d)})},f.logout=function(){d.destroy(),delete c.sessionStorage.session,b.path("/login")},f.isAuthenticated=function(){return!!d.userId},f.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),-1!==a.indexOf("*")||f.isAuthenticated()&&-1!==a.indexOf(d.userRole)},f}]),angular.module("barliftApp").service("Session",["$http",function(a){return this.create=function(b,c,d,e){this.userId=b,this.userName=c,this.sessionToken=d,this.userRole=e,a.defaults.headers.common["X-Parse-Session-Token"]=d},this.setRole=function(a){this.userRole=a},this.destroy=function(){this.username=null,this.sessionToken=null,this.userRole=null,this.userId=null,delete a.defaults.headers.common["X-Parse-Session-Token"]},this}]),angular.module("barliftApp").factory("Emails",["$resource","ParseTypes",function(a,b){var c=a("https://api.parse.com/1/classes/email/");return c}]),angular.module("barliftApp").directive("ngAutocomplete",function(){return{require:"ngModel",scope:{ngModel:"=",options:"=?",details:"=?"},link:function(a,b,c,d){var e,f=!1,g=function(){e={},a.options&&(f=a.options.watchEnter!==!0?!1:!0,a.options.types?(e.types=[],e.types.push(a.options.types),a.gPlace.setTypes(e.types)):a.gPlace.setTypes([]),a.options.bounds?(e.bounds=a.options.bounds,a.gPlace.setBounds(e.bounds)):a.gPlace.setBounds(null),a.options.country?(e.componentRestrictions={country:a.options.country},a.gPlace.setComponentRestrictions(e.componentRestrictions)):a.gPlace.setComponentRestrictions(null))};void 0==a.gPlace&&(a.gPlace=new google.maps.places.Autocomplete(b[0],{})),google.maps.event.addListener(a.gPlace,"place_changed",function(){var c=a.gPlace.getPlace();void 0!==c&&(void 0!==c.address_components?a.$apply(function(){a.details=c,d.$setViewValue(b.val())}):f&&h(c))});var h=function(c){var e=new google.maps.places.AutocompleteService;c.name.length>0&&e.getPlacePredictions({input:c.name,offset:c.name.length},function(c,e){if(null==c||0==c.length)a.$apply(function(){a.details=null});else{var f=new google.maps.places.PlacesService(b[0]);f.getDetails({reference:c[0].reference},function(c,e){e==google.maps.GeocoderStatus.OK&&a.$apply(function(){d.$setViewValue(c.formatted_address),b.val(c.formatted_address),a.details=c;b.on("focusout",function(a){b.val(c.formatted_address),b.unbind("focusout")})})})}})};d.$render=function(){var a=d.$viewValue;b.val(a)},a.watchOptions=function(){return a.options},a.$watch(a.watchOptions,function(){g()},!0)}}}),angular.module("barliftApp").factory("Push",["$resource","ParseTypes",function(a,b){var c=a("https://api.parse.com/1/push",null,{push:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}}});return c}]),angular.module("barliftApp").directive("pageTitle",["$rootScope","$timeout",function(a,b){return{link:function(c,d,e){var f=function(a,c,e,f,g){var h="INSPINIA | Responsive Admin Theme";c.data&&c.data.pageTitle&&(h="INSPINIA | "+c.data.pageTitle),b(function(){d.text(h)})};a.$on("$stateChangeStart",f)}}}]),angular.module("barliftApp").directive("sideNavigation",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c.metisMenu()})}}}]),angular.module("barliftApp").directive("iboxTools",["$timeout",function(a){return{scope:!0,templateUrl:"views/dash/common/ibox_tools.html",restrict:"A",controller:["$scope","$element",function(b,c){b.showhide=function(){var b=c.closest("div.ibox"),d=c.find("i:first"),e=b.find("div.ibox-content");e.slideToggle(200),d.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),b.toggleClass("").toggleClass("border-bottom"),a(function(){b.resize(),b.find("[id^=map-]").resize()},50)},b.closebox=function(){var a=c.closest("div.ibox");a.remove()}}]}}]),angular.module("barliftApp").directive("minimalizaSidebar",function(){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:["$scope","$element",function(a,b){a.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},100)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(500)},300)):$("#side-menu").removeAttr("style")}}]}}),angular.module("barliftApp").directive("dealList",function(){return{templateUrl:"views/dash/directives/deal-list.html",restrict:"E",scope:{deals:"="},link:function(a,b,c){}}}),angular.module("barliftApp").directive("dealBuilder",["Deals","$http","$stateParams","$filter","$state",function(a,b,c,d,e){return{templateUrl:"views/dash/directives/deal-builder.html",restrict:"E",scope:{user:"=",deals:"=",venues:"="},link:function(f,g,h){f.$watch("deals",function(){if(c.selectedDeal){var b=d("filter")(f.deals,{objectId:c.selectedDeal})[0];b?f.deal=b:e.go("deals.builder",{selectedDeal:void 0})}else f.deal=a.newDeal(f.user)}),b.get("https://api.parse.com/1/config").success(function(a,b,c,d){f.communities=a.params.communities}),f.deleteDeal=function(){a["delete"](f.deal,function(b){f.deal=a.newDeal(f.user),a.query(function(a){f.deals=a}),e.go("deals.builder",{selectedDeal:void 0})})},f.saveDeal=function(){f.deal.venue=f.deal.venue.getPointer(),a.save(f.deal,function(b){f.deal=a.newDeal(f.user),a.query(function(a){f.deals=a})})},f.updateDeal=function(){f.deal.venue=f.deal.venue.getPointer(),a.update(f.deal,function(){f.deal=a.newDeal(f.user),a.query(function(a){f.deals=a})})}}}}]),angular.module("barliftApp").factory("Yelp",["$http",function(a){function b(a,b){for(var c="",d=a;d>0;--d)c+=b[Math.round(Math.random()*(b.length-1))];return c}return{getBusiness:function(c,d){var e="GET",f="http://api.yelp.com/v2/business/"+c,g={callback:"angular.callbacks._0",oauth_consumer_key:"Zm9xJcBs-wTA2xgNsYwUHQ",oauth_token:"KLi_UOL1kXiRjL46U7MaMFasADLeMS24",oauth_signature_method:"HMAC-SHA1",oauth_timestamp:(new Date).getTime(),oauth_nonce:b(32,"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")},h="dIbUA7qGcUovMxYz0Y9fYevD1dw",i="l7iJTLAp73HHm5_R8ac2LzNX7po",j=oauthSignature.generate(e,f,g,h,i,{encodeSignature:!1});g.oauth_signature=j,a.jsonp(f,{params:g}).success(d)}}}]),angular.module("barliftApp").directive("venueBuilder",["Venues","$http","$stateParams","$filter","$state","Yelp",function(a,b,c,d,e,f){return{templateUrl:"views/dash/directives/venue-builder.html",restrict:"E",scope:{user:"=",venues:"="},link:function(b,g,h){function i(a,b){var c=new google.maps.Geocoder;c.geocode({address:a},function(a,c){c==google.maps.GeocoderStatus.OK&&b(a[0].geometry.location)})}b.$watch("venues",function(){if(c.selectedVenue){var f=d("filter")(b.venues,{objectId:c.selectedVenue})[0];f?b.venue=f:e.go("venues.builder",{selectedVenue:void 0})}else b.venue=a.newVenue(b.user)}),b.loadYelp=function(a){a=a.replace("http://",""),a=a.replace("www.yelp.com/biz/",""),f.getBusiness(a,function(a){b.venue.bar_name=a.name,b.venue.display_phone=a.display_phone,b.venue.image_url=a.image_url,b.venue.address=a.location.display_address[0]+" "+a.location.display_address[1]})},b["delete"]=function(){a["delete"](b.venue,function(c){b.venue=a.newVenue(b.user),a.query(function(a){b.venues=a}),e.go("venues.builder",{selectedDeal:void 0})})},b.save=function(){if(b.locationDetails){var c=b.locationDetails.geometry.location;b.venue.location={latitude:c.k,longitude:c.D},a.save(b.venue,function(c){b.venue=a.newVenue(b.user),a.query(function(a){b.venues=a})})}else var c=i(b.venue.address,function(c){b.venue.location={latitude:c.k,longitude:c.D},a.save(b.venue,function(c){b.venue=a.newVenue(b.user),a.query(function(a){b.venues=a})})})}}}}]),angular.module("barliftApp").factory("Venues",["$resource","ParseTypes","Session",function(a,b,c){var d=a("https://api.parse.com/1/classes/Venue/:objectId",{objectId:"@objectId"},{save:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},query:{isArray:!0,transformResponse:function(a,c){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return b.resProcess(a,"Venue")});return e}},update:{method:"PUT",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},"delete":{method:"DELETE"}});return d.newVenue=function(a){var b={ACL:{"*":{read:!0},"role:Admin":{read:!0,write:!0}},schema:[{key:"location",__type:"GeoPoint"},{key:"manager",__type:"Pointer",className:"_User"}]};return b.ACL[c.userId]={read:!0,write:!0},b.manager=c.userId,b},d}]),angular.module("barliftApp").directive("dealAnalytics",["$stateParams","$filter","User","Deals","$state",function(a,b,c,d,e){return{templateUrl:"views/dash/directives/deal-analytics.html",restrict:"E",scope:{user:"=",deals:"=",deal:"="},link:function(d,f,g){function h(a){c.query({where:{$relatedTo:{object:{__type:"Pointer",className:"Deal",objectId:a},key:"social"}}},function(a){i(a)})}function i(a){angular.forEach(a,function(a){"female"==a.profile.gender?d.gender.datasets[0].data[1]+=1:d.gender.datasets[0].data[0]+=1,d.interestedCount+=1,a.num_nights&&"Choose a number..."!=a.num_nights&&(d.nightsOut[parseInt(a.num_nights)].value+=1),a.deals_redeemed&&(d.avgDealsRedeemed+=parseInt(a.deals_redeemed))}),d.avgDealsRedeemed=d.avgDealsRedeemed/d.interestedCount}a.selectedDeal?h(a.selectedDeal):f.text("Please select a deal"),d.$watch("deals",function(){if(a.selectedDeal){var c=b("filter")(d.deals,{objectId:a.selectedDeal})[0];c?d.deal=c:e.go("deals.builder",{selectedDeal:void 0})}}),d.gender={labels:["Male","Female"],datasets:[{data:[0,0]}]},d.nightsOut=[{value:0,color:"#37464A",highlight:"#FF5A5E",label:"0 night"},{value:0,color:"#37464A",highlight:"#FF5A5E",label:"1 night"},{value:0,color:"#F7484B",highlight:"#FF5A5E",label:"2 nights"},{value:0,color:"#F74A6C",highlight:"#FF5A5E",label:"3 nights"},{value:0,color:"#AB7464D",highlight:"#FF5A5E",label:"4 nights"},{value:0,color:"#F5464E",highlight:"#FF5A5E",label:"5 nights"},{value:0,color:"#F7F24F",highlight:"#FF5A5E",label:"6 nights"},{value:0,color:"#F74C41",highlight:"#FF5A5E",label:"7 nights"}],d.doughnutOptions={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:45,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1},d.barOptions={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1},d.interestedCount=0,d.avgDealsRedeemed=0}}}]),angular.module("barliftApp").controller("BarFeedbackCtrl",["$scope","$stateParams","Deals","User","Feedback",function(a,b,c,d,e){a.deal={},a.bar_name={},a.selected="parent",this.setSelected=function(b){a.selected=b},c.get({objectId:b.dealId},function(b){a.deal=b,d.get({objectId:b.user},function(b){a.bar_name=b.bar_name})})}]),angular.module("barliftApp").directive("feedbackForm",["Deals","Feedback",function(a,b){return{templateUrl:"views/dash/directives/feedback-form.html",restrict:"E",require:"^ngController",link:function(a,c,d,e){a.feedback={},a.submit=function(){a.feedback.deal=a.deal.getPointer(),b.save(a.feedback),e.setSelected("submitted")}}}}]),angular.module("barliftApp").factory("Feedback",["$resource","ParseTypes","Session",function(a,b,c){var d=a("https://api.parse.com/1/classes/Feedback/:objectId",{objectId:"@objectId"},{save:{method:"POST",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},get:{transformResponse:function(a,c){a=angular.fromJson(a);var d=a.results;return b.resProcess(d,"Feedback")}},query:{isArray:!0,transformResponse:function(a,c){a=angular.fromJson(a);var d=a.results,e=d.map(function(a){return b.resProcess(a,"Feedback")});return e}},update:{method:"PUT",transformRequest:function(a,c){var d=b.reqProcess(a);return d=angular.toJson(d)}},"delete":{method:"DELETE"}});return d.newFeedback=function(){var a=new Date,b=new Date(a.getFullYear(),a.getMonth(),a.getDate()),d={ACL:{"*":{read:!0},"role:Admin":{read:!0,write:!0}},schema:[{key:"deal_start_date",__type:"Date"},{key:"deal_end_date",__type:"Date"},{key:"user",__type:"Pointer",className:"_User"}],deal_start_date:b,deal_end_date:b};return d.ACL[c.userId]={read:!0,write:!0},d},d}]);
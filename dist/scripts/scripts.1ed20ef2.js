"use strict";angular.module("barliftApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).when("/bar",{templateUrl:"views/bar.html",controller:"BarCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","User",function(a,b,c){Parse.initialize("5DZi1FrdZcwBKXIxMplWsqYu3cEEumlmFDB1kKnC","G7yhVdBRY3S2jvjkHKddlsES5YZu1z99Nh9JPLTN"),c.getUser(),a.$on("$routeChangeStart",function(){})}]),angular.module("barliftApp").controller("MainCtrl",["$scope","ParseService",function(a,b){a.navPages=[{name:"About",link:"#sec1"},{name:"Team",link:"#sec3"},{name:"For Bars",link:"#sec4"}],a.user={email:null,barName:null,isBar:!1},a.addEmail=function(c){"undefined"==typeof a.user.email?a.user.email="Invalid Email!":(a.user.isBar="isBar"===c?!0:!1,b.addEmail(a.user.email,a.user.isBar,a.user.barName,function(){a.$apply(function(){a.user.email="Thanks!"})}))}}]),angular.module("barliftApp").controller("HeaderCtrl",["$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("barliftApp").factory("ParseService",["$rootScope",function(a){Parse.initialize("5DZi1FrdZcwBKXIxMplWsqYu3cEEumlmFDB1kKnC","G7yhVdBRY3S2jvjkHKddlsES5YZu1z99Nh9JPLTN"),a.loggedInUser;var b=Parse.Object.extend("email"),c={name:"Parse",login:function(b,c,d){Parse.User.logIn(b,c,{success:function(b){a.loggedInUser=b,d(b)},error:function(a,b){alert("Error: "+b.message)}})},logout:function(){Parse.User.logOut(),a.loggedInUser=null},getEmails:function(a){var c=new Parse.Query(b);c.find({success:function(b){a(b)},error:function(a){alert("Error: "+a.message)}})},addEmail:function(a,c,d,e){var f=new b;f.save({email:a,name:d,isBar:c},{success:function(a){e(a)},error:function(a){alert("Error: "+a.message)}})},getUser:function(){return a.loggedInUser?a.loggedInUser:void 0},isLoggedIn:function(){return a.loggedInUser?!0:!1}};return c}]),angular.module("barliftApp").controller("LoginCtrl",["$scope","$location","User",function(a,b,c){c.isLoggedIn()&&c.getUserRole(function(c){a.$apply(function(){b.path("/"+c.toLowerCase())})}),a.login=function(){c.login(a.login_username,a.login_password,function(){c.getUserRole(function(c){a.$apply(function(){b.path("/"+c.toLowerCase())})})})}}]),angular.module("barliftApp").controller("AdminCtrl",["$scope","$location","User","ParseService",function(a,b,c,d){c.isLoggedIn()?c.checkUserRole("Admin",function(c){c||a.$apply(function(){b.path("/login")})}):b.path("/login"),a.emails=[],d.getEmails(function(b){a.$apply(function(){a.emails=b})}),a.logout=function(){c.logout(),b.path("/login")}}]),angular.module("barliftApp").directive("emailGrid",function(){return{templateUrl:"views/emailgrid.html",restrict:"E",link:function(){}}}),angular.module("barliftApp").directive("scrollOnClick",function(){return{restrict:"A",link:function(a,b,c){var d=c.href;b.on("click",function(){var a;a=d?$(d):b,$("body").animate({scrollTop:a.offset().top},"slow")})}}}),angular.module("barliftApp").directive("navbar",function(){return{templateUrl:"views/navbar.html",restrict:"E",scope:{pages:"="},link:function(){}}}),angular.module("barliftApp").factory("User",function(){var a,b={name:"User",login:function(b,c,d){Parse.User.logIn(b,c,{success:function(b){a=b,d(b)},error:function(a,b){alert("Error: "+b.message)}})},logout:function(){Parse.User.logOut(),a=null},getUser:function(){return a||Parse.User.current()?(a=Parse.User.current(),Parse.User.current()):void 0},getUserPointer:function(){return{__type:"Pointer",className:"_User",objectId:a.id}},isLoggedIn:function(){return a||Parse.User.current()?!0:!1},checkUserRole:function(a,b){var c=new Parse.Query(Parse.Role);c.equalTo("name",a),c.equalTo("users",Parse.User.current()),c.first({success:function(a){b(a?!0:!1)}})},getUserRole:function(a){var b=new Parse.Query("_Role");b.find({success:function(b){for(var c=0;c<b.length;c++){var d=new Parse.Query(Parse.Role);d.equalTo("objectId",b[c].id),d.equalTo("users",Parse.User.current()),d.first({success:function(b){b&&a(b.get("name"))}})}},error:function(){}})}};return b}),angular.module("barliftApp").factory("Deals",["$resource",function(a){var b="5DZi1FrdZcwBKXIxMplWsqYu3cEEumlmFDB1kKnC",c="pMT9AefpMkJfbcJ5fTA2uOGxwpitMII7hpCt8x4O";return function(d){var e={"X-Parse-Application-Id":b,"X-Parse-REST-API-Key":c};return d&&angular.extend(e,e,{"X-Parse-Session-Token":d._sessionToken}),a("https://api.parse.com/1/classes/Deal/:objectId",{objectId:"@objectId"},{save:{method:"POST",headers:e},query:{headers:e},update:{method:"PUT",headers:e}})}}]),angular.module("barliftApp").controller("BarCtrl",["$scope","$location","User","Deals",function(a,b,c,d){c.isLoggedIn()?c.checkUserRole("Bar",function(c){c||a.$apply(function(){b.path("/login")})}):b.path("/login"),a.bar=c.getUser(),console.log(a.bar),a.deals=[],a.selectedDeal={},a.loadDeals=function(){d(c.getUser()).query({where:{user:c.getUserPointer()}},function(b){console.log(b),a.deals=b.results})},a.loadDeals(),a.saveDeal=function(b){b.objectId?d(c.getUser()).update(b,function(b){console.log(b),a.loadDeals()}):(b.ACL={},b.ACL["*"]={read:!0},b.ACL[c.getUser().id]={read:!0,write:!0},b.ACL["role:Admin"]={read:!0,write:!0},b.user=c.getUserPointer(),d(c.getUser()).save(b,function(b){console.log(b),a.loadDeals()}))},a.selectDeal=function(b){a.selectedDeal=b},a.logout=function(){c.logout(),b.path("/login")}}]),angular.module("barliftApp").directive("dealList",function(){return{templateUrl:"views/deallist.html",restrict:"E",scope:{deals:"=",select:"&"},link:function(){}}}),angular.module("barliftApp").directive("dealForm",function(){return{templateUrl:"views/dealform.html",restrict:"E",scope:{deal:"=",save:"&"},link:function(a){a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.toggleMin=function(){a.minDate=a.minDate?null:new Date},a.toggleMin(),a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={formatYear:"yy",startingDay:1},a.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0]}}});